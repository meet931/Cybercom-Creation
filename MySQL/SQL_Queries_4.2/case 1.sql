CREATE DATABASE SQL_Queries_4_2;
USE SQL_Queries_4_2;

-- ------------ CASE 1 ------------
CREATE TABLE EMPLOYEES (
    EMPLOYEE_ID INT PRIMARY KEY,
    NAME VARCHAR(255),
    DEPARTMENT_ID INT,
    SALARY DECIMAL(10, 2),
    FOREIGN KEY (DEPARTMENT_ID) REFERENCES DEPARTMENTS(DEPARTMENT_ID)
);

CREATE TABLE DEPARTMENTS (
    DEPARTMENT_ID INT PRIMARY KEY,
    DEPARTMENT_NAME VARCHAR(255)
);

CREATE TABLE SALARIES (
    EMPLOYEE_ID INT,
    SALARY DECIMAL(10, 2),
    SALARY_DATE DATE,
    FOREIGN KEY (EMPLOYEE_ID) REFERENCES EMPLOYEES(EMPLOYEE_ID)
);

INSERT INTO DEPARTMENTS (DEPARTMENT_ID, DEPARTMENT_NAME) VALUES
(1, 'Sales'),
(2, 'Marketing'),
(3, 'Finance'),
(4, 'Human Resources');

INSERT INTO EMPLOYEES (EMPLOYEE_ID, NAME, DEPARTMENT_ID, SALARY) VALUES
(1, 'John Doe', 1, 60000),
(2, 'Jane Smith', 1, 62000),
(3, 'Michael Johnson', 2, 55000),
(4, 'Emily Brown', 1, 70000),
(5, 'David Wilson', 3, 65000),
(6, 'Sarah Anderson', 1, 72000),
(7, 'James Martinez', 2, 75000),
(8, 'Jennifer Lee', 3, 80000),
(9, 'Daniel Garcia', 1, 60000),
(10, 'Jessica Rodriguez', 4, 48000);

INSERT INTO SALARIES (EMPLOYEE_ID, SALARY, SALARY_DATE) VALUES
(1, 60000, '2023-01-01'),
(2, 62000, '2024-01-01'),
(3, 55000, '2024-01-11'),
(4, 70000, '2023-01-21'),
(5, 65000, '2023-01-10'),
(6, 72000, '2023-01-09'),
(7, 75000, '2024-01-01'),
(8, 80000, '2023-01-01'),
(9, 60000, '2023-01-01'),
(10, 48000, '2023-01-01');

SELECT * FROM EMPLOYEES;
SELECT * FROM DEPARTMENTS;
SELECT * FROM SALARIES;

-- 1. Write a query to return the names of all employees who work in the 'Sales' department.
SELECT E.NAME, COUNT(E.DEPARTMENT_ID) AS "DEPARTMENT" FROM EMPLOYEES E
LEFT JOIN DEPARTMENTS D ON E.DEPARTMENT_ID = D.DEPARTMENT_ID
WHERE D.DEPARTMENT_NAME = "Sales"
GROUP BY E.NAME;


-- 2. Write a query to return the total number of employees in each department, ordered by department name.
SELECT D.DEPARTMENT_NAME, COUNT(EMPLOYEE_ID) AS "NUMBER OF EMPLOYEES" FROM DEPARTMENTS D
LEFT JOIN EMPLOYEES E ON D.DEPARTMENT_ID = E.DEPARTMENT_ID
GROUP BY D.DEPARTMENT_NAME
ORDER BY D.DEPARTMENT_NAME;


-- 3. Write a query to return the average salary for each department, ordered by department name.
SELECT D.DEPARTMENT_NAME, AVG(E.SALARY) AS "AVG SALARY" FROM DEPARTMENTS D
JOIN EMPLOYEES E ON D.DEPARTMENT_ID = E.DEPARTMENT_ID
GROUP BY D.DEPARTMENT_NAME
ORDER BY D.DEPARTMENT_NAME;


-- 4. Write a query to return the top 10% of highest paid employees, ordered by salary.
SELECT NAME, SALARY FROM (
    SELECT NAME, SALARY, NTILE(10) OVER (ORDER BY SALARY DESC) AS SALARY_PERCENTILE FROM EMPLOYEES) AS PERCENTILE_QUERY
WHERE 
    SALARY_PERCENTILE = 1
ORDER BY 
    SALARY DESC;


-- 5. Write a query to return the salary of each employee for their latest salary entry.
SELECT E.NAME, E.SALARY, S.SALARY_DATE "SALARY DATE" FROM EMPLOYEES E
JOIN SALARIES S ON E.EMPLOYEE_ID = S.EMPLOYEE_ID
WHERE S.SALARY_DATE  = (SELECT MAX(S.SALARY_DATE) FROM SALARIES)
ORDER BY S.SALARY_DATE DESC;












