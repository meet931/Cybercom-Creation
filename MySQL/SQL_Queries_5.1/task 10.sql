-- 10. Write a SQL query to retrieve the names of all products in the "products" table that have been ordered by customers in more than one country, along with the names of 
--     the countries where the products have been ordered.

CREATE TABLE CUSTOMERST9 (
    CUSTOMER_ID INT PRIMARY KEY,
    CUSTOMER_NAME VARCHAR(255),
    COUNTRY_NAME VARCHAR(255)
);

CREATE TABLE PRODUCTST9 (
    PRODUCT_ID INT PRIMARY KEY,
    PRODUCT_NAME VARCHAR(100)
);

CREATE TABLE ORDERST9 (
    ORDER_ID INT PRIMARY KEY,
    CUSTOMER_ID INT,
    COUNTRY_NAME VARCHAR(100),
    FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERST9(CUSTOMER_ID)
);

CREATE TABLE ORDER_DETAILST9 (
    ORDER_DETAIL_ID INT PRIMARY KEY,
    ORDER_ID INT,
    PRODUCT_ID INT,
    FOREIGN KEY (ORDER_ID) REFERENCES ORDERST9(ORDER_ID),
    FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTST9(PRODUCT_ID)
);

-- Inserting dummy data into CUSTOMERST9 table
INSERT INTO CUSTOMERST9 (CUSTOMER_ID, CUSTOMER_NAME, COUNTRY_NAME) VALUES
(1, 'John Doe', 'USA'),
(2, 'Alice Smith', 'UK'),
(3, 'Bob Johnson', 'USA'),
(4, 'Emily Brown', 'Canada'),
(5, 'Michael Lee', 'UK');

-- Inserting dummy data into PRODUCTST9 table
INSERT INTO PRODUCTST9 (PRODUCT_ID, PRODUCT_NAME) VALUES
(1, 'Laptop'),
(2, 'Smartphone'),
(3, 'Tablet');

-- Inserting dummy data into ORDERST9 table
INSERT INTO ORDERST9 (ORDER_ID, CUSTOMER_ID, COUNTRY_NAME) VALUES
(101, 1, 'USA'),
(102, 2, 'UK'),
(103, 3, 'USA'),
(104, 4, 'Canada'),
(105, 5, 'UK');

-- Inserting dummy data into ORDER_DETAILST9 table
INSERT INTO ORDER_DETAILST9 (ORDER_DETAIL_ID, ORDER_ID, PRODUCT_ID) VALUES
(201, 101, 1),
(202, 102, 1),
(203, 103, 2),
(204, 104, 2),
(205, 105, 3),
(206, 105, 1),
(207, 102, 2),
(208, 101, 3),
(209, 103, 1),
(210, 101, 2);

SELECT * FROM CUSTOMERST9;
SELECT * FROM PRODUCTST9;
SELECT * FROM ORDERST9;
SELECT * FROM ORDER_DETAILST9;

DROP TABLE CUSTOMERST9;
DROP TABLE ORDERST9;
DROP TABLE ORDER_DETAILST9;
DROP TABLE PRODUCTST9;
    
SELECT p.PRODUCT_NAME, GROUP_CONCAT(DISTINCT o.COUNTRY_NAME SEPARATOR ", ") AS "COUNTRY NAME"
FROM PRODUCTST9 p
JOIN ORDER_DETAILST9 od ON p.PRODUCT_ID = od.PRODUCT_ID
JOIN ORDERST9 o ON od.ORDER_ID = o.ORDER_ID
WHERE 
    p.PRODUCT_ID IN (
        SELECT od.PRODUCT_ID 
        FROM ORDER_DETAILST9 od
        JOIN ORDERST9 o ON od.ORDER_ID = o.ORDER_ID
        GROUP BY od.PRODUCT_ID
        HAVING COUNT(DISTINCT o.COUNTRY_NAME) > 1
    )
GROUP BY P.PRODUCT_ID;



