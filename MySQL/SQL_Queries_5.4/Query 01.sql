CREATE DATABASE SQL_Queries_5_4;
USE SQL_Queries_5_4;

-- 1. Write a SQL query to retrieve the names of all customers who have made at least one order in the "orders" table and have not made 
--    any orders in the "returns" table.

CREATE TABLE CUSTOMERS (
    CUSTOMER_ID INT PRIMARY KEY,
    CUSTOMER_NAME VARCHAR(50)
);

CREATE TABLE CATEGORIES (
    CATEGORY_ID INT PRIMARY KEY,
    CATEGORY_NAME VARCHAR(100)
);

CREATE TABLE PRODUCTS (
    PRODUCT_ID INT PRIMARY KEY,
    PRODUCT_NAME VARCHAR(100),
    CATEGORY_ID INT,
    FOREIGN KEY (CATEGORY_ID) REFERENCES CATEGORIES(CATEGORY_ID)
);

CREATE TABLE ORDERS (
    ORDER_ID INT PRIMARY KEY,
    CUSTOMER_ID INT,
    PRODUCT_ID INT,
    ORDER_DATE DATE,
    ORDER_AMOUNT DECIMAL(10, 2),
    FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMERS(CUSTOMER_ID),
    FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCTS(PRODUCT_ID)
);

CREATE TABLE RETURNS (
    RETURN_ID INT PRIMARY KEY,
    ORDER_ID INT,
    RETURN_DATE DATE,
    FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_ID)
);

INSERT INTO CUSTOMERS (CUSTOMER_ID, CUSTOMER_NAME) VALUES
(1, 'John'),
(2, 'Alice'),
(3, 'Bob');

INSERT INTO CATEGORIES (CATEGORY_ID, CATEGORY_NAME) VALUES
(1, 'Electronics'),
(2, 'Clothing'),
(3, 'Books');

INSERT INTO PRODUCTS (PRODUCT_ID, PRODUCT_NAME, CATEGORY_ID) VALUES
(1, 'Smartphone', 1),
(2, 'Laptop', 1),
(3, 'T-Shirt', 2),
(4, 'Jeans', 2),
(5, 'Novel', 3),
(6, 'Textbook', 3);

INSERT INTO ORDERS (ORDER_ID, CUSTOMER_ID, PRODUCT_ID, ORDER_DATE, ORDER_AMOUNT) VALUES
(101, 1, 1, '2024-03-01', 50.00),
(102, 2, 2, '2024-03-02', 80.00),
(103, 1, 3, '2024-03-03', 120.00),
(104, 3, 4, '2024-03-04', 40.00),
(105, 2, 5, '2024-03-05', 60.00),
(106, 1, 6, '2024-03-06', 90.00),
(107, 3, 1, '2024-03-07', 70.00),
(108, 2, 2, '2024-03-08', 110.00);

INSERT INTO RETURNS (RETURN_ID, ORDER_ID, RETURN_DATE) VALUES
(201, 101, '2024-03-10'),
(202, 103, '2024-03-12'),
(203, 102, '2024-03-11'),
(204, 105, '2024-03-15');

SELECT * FROM CUSTOMERS;
SELECT * FROM ORDERS;
SELECT * FROM CATEGORIES;
SELECT * FROM PRODUCTS;
SELECT * FROM RETURNS;


SELECT C.CUSTOMER_NAME FROM CUSTOMERS C
JOIN ORDERS O ON C.CUSTOMER_ID = O.CUSTOMER_ID
LEFT JOIN RETURNS R ON O.ORDER_ID = R.ORDER_ID
GROUP BY C.CUSTOMER_ID, C.CUSTOMER_NAME
HAVING COUNT(O.CUSTOMER_ID) >= 1 AND COUNT(R.ORDER_ID) = 0;